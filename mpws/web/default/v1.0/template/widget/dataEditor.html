{* Get Configuration For The Widget *}
{$_widgetName = "dataEditor"}
{$_widgetCustomName = "`$_widgetName``$CURRENT.SOURCE.NAME`"}
{assign var="DTV_CFG" value=$CURRENT.OBJECT->{"objectConfiguration_widget_dataEditor`$CURRENT.SOURCE.NAME`"}}

<div id="MPWSWidget{$_widgetName|capitalize}{$CURRENT.SOURCE.NAME}ID" class="MPWSWidget MPWSWidget{$_widgetName|capitalize} MPWSWidget{$_widgetName|capitalize}{$CURRENT.SOURCE.NAME}">
    
    {$_formInnerAction = $CURRENT.SOURCE.DATA.EDIT_PAGE}

    {* widget title *}
    {if $CURRENT.SOURCE.DATA.ISNEW}
        {include file=$CURRENT.OBJECT->objectTemplatePath_component_widgetSummary _ownerName=$_widgetCustomName _customText=$CURRENT.OBJECT->{"objectProperty_widget_dataEditorStateNewPage`$_formInnerAction|upper`"}}
    {else}
        {include file=$CURRENT.OBJECT->objectTemplatePath_component_widgetSummary _ownerName=$_widgetCustomName _customText=$CURRENT.OBJECT->{"objectProperty_widget_dataEditorStateExistedPage`$_formInnerAction|upper`"}}
    {/if}
    
    {* error block *}
    {if not $CURRENT.SOURCE.DATA.VALID}
        {include file=$CURRENT.OBJECT->objectTemplatePath_component_errorFieldsList _fields=$CURRENT.SOURCE.DATA.ERRORS _ownerName=$_widgetCustomName}
    {/if}
    
    {* editor form *}
    <form action="{$DTV_CFG.form.$_formInnerAction.action}" name="data_edit_{$CURRENT.SOURCE.NAME|lower}" method="{$DTV_CFG.form.$_formInnerAction.method}" class="MPWSForm MPWSFormEditor MPWSFormEditorPage{$_formInnerAction|capitalize:0:1}">

    {* page content *}
    
    {if $_formInnerAction eq "new"}
    
        {* create new form page *}
        {* completely new record without any initial data *}
        {foreach $CURRENT.SOURCE.DATA.FIELDS as $fieldIndex => $fieldEntry}
            {include file=$CURRENT.OBJECT->objectTemplatePath_component_controlFieldSwitcher _type=$fieldEntry.Type _name=$fieldEntry.Field _ownerName=$_widgetCustomName}
        {/foreach}

    
    {elseif $_formInnerAction eq "edit"}
    
        {* edit form page *}
        {foreach $CURRENT.SOURCE.DATA.FIELDS as $fieldIndex => $fieldEntry}
        
            {$_editFieldRenderMode = 'normal'}
            {if not empty($CURRENT.SOURCE.DATA.ERRORS) and in_array($fieldEntry.Field, $CURRENT.SOURCE.DATA.ERRORS) }
                {$_editFieldRenderMode = 'error'}
            {/if}
        
            {if $CURRENT.SOURCE.DATA.ISNEW}
                {include file=$CURRENT.OBJECT->objectTemplatePath_component_controlFieldSwitcher _type=$fieldEntry.Type _name=$fieldEntry.Field _ownerName=$_widgetCustomName _render=$_editFieldRenderMode}
            {else}
                {$_controlValue = $CURRENT.SOURCE.DATA.SOURCE[$fieldEntry.Field]}
                {$_controlValue}
                {include file=$CURRENT.OBJECT->objectTemplatePath_component_controlFieldSwitcher _type=$fieldEntry.Type _name=$fieldEntry.Field _ownerName=$_widgetCustomName _value=$_controlValue _render=$_editFieldRenderMode}
            {/if}
            
            
        {/foreach}

    {/if}
        
    {if $_formInnerAction eq "preview"}
    
        {* preview page *}
        {foreach $CURRENT.SOURCE.DATA.FIELDS as $fieldIndex => $fieldEntry}
            {include file=$CURRENT.OBJECT->objectTemplatePath_component_controlFieldSwitcher _type=$fieldEntry.Type _name=$fieldEntry.Field _ownerName=$_widgetCustomName _readonly=true}
        {/foreach}
        
    {elseif $_formInnerAction eq "save"}
    
        {* saved page *}
        {include file=$CURRENT.OBJECT->objectTemplatePath_component_simpleTextLabel _resource='widget' _ownerName=$_widgetName _key='SaveMain'}
        {include file=$CURRENT.OBJECT->objectTemplatePath_component_simpleTextLabel _resource='widget' _ownerName=$_widgetName _key='SaveSubText'}
        
    {elseif $_formInnerAction eq "cancel"}
    
        {* canceled page *}
        {include file=$CURRENT.OBJECT->objectTemplatePath_component_simpleTextLabel _resource='widget' _ownerName=$_widgetName _key='CancelMain'}
        {include file=$CURRENT.OBJECT->objectTemplatePath_component_simpleTextLabel _resource='widget' _ownerName=$_widgetName _key='CancelSubText'}
        
    {/if}
    
    {* custom fields *}
    {foreach $DTV_CFG.form.$_formInnerAction.customFileds as $fieldName => $fieldType}
        {include file=$CURRENT.OBJECT->objectTemplatePath_component_controlFieldSwitcher _type=$fieldType _name=$fieldName _ownerName=$_widgetCustomName}
    {/foreach}
    
    {* form controls *}
    {include file=$CURRENT.OBJECT->objectTemplatePath_component_simpleFormButtons _resource='custom' _page=$_formInnerAction _buttons=$DTV_CFG.form.$_formInnerAction.controls}
    
    </form>

    {* additional links *}
    <div class="MPWSBlock MPWSBlockDataEditorBottomLinks">
        {include file=$CURRENT.OBJECT->objectTemplatePath_component_simpleHyperlink _href=$CURRENT.SOURCE.DATA.REFERER _title=$CURRENT.OBJECT->objectProperty_component_formControlLinkReturn}
    </div>

</div>