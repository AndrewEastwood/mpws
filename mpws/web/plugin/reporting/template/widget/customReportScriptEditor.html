{$_widgetName = "CustomReportScriptEditor"}
{$_resourceOwner = "customReportScriptEditor"}
{assign var="DTV_CFG" value=$CURRENT.OBJECT->{"objectConfiguration_widget_`$_resourceOwner`"}}

<div id="MPWSWidget{$_resourceOwner|capitalize}ID" class="MPWSWidget MPWSWidgetCustom MPWSWidget{$_widgetName} MPWSWidget{$_resourceOwner|capitalize}">
    
    {* list of all reports *}
    <div class="MPWSBlock MPWSBlockAllReportLinks">
        {foreach $CURRENT.SOURCE.DATA.REPORTS as $idx => $entry}
            {* show report owner *}
        <ul class="MPWSList">
            <li class="MPWSListItem">
            {include file=$CURRENT.OBJECT->objectTemplatePath_trigger_control
                _type='mpwsLinkAction'
                _name=$entry.ExternalKey
                _controlOwner=$_widgetName
                _action="ShowReport_`$entry.ID`"
                _resourceOwner=$_resourceOwner
                _href="javascript://"
                _single=true
                _useValueAsTitle=$entry.Name
                _mode='system'}
            {* show report scripts *}
            {if not empty($entry.Reports)}
                <ul class="MPWSList MPWSListSub">
                {$_scriptList = explode(';', trim($entry.Reports, ';'))}
                {foreach $_scriptList as $scriptName}
                    <li class="MPWSListItem">
                    {include file=$CURRENT.OBJECT->objectTemplatePath_trigger_control
                        _type='mpwsLinkAction'
                        _name=$scriptName
                        _controlOwner=$_widgetName
                        _action="EditReport"
                        _oid=$entry.ID
                        _resourceOwner=$_resourceOwner
                        _single=true
                        _useValueAsTitle=$scriptName
                        _customParams=['script'=>$scriptName]
                        _mode='system'}
                    </li>
                {/foreach}
                </li>
            {/if}
            </li>
        </ul>
        {/foreach}
    </div>
    
    {* workplace *}
    {* TODO: move the section below as standalone control *}
    <div class="MPWSBlock MPWSBockReportScriptEditArea">
        {if $CURRENT.SOURCE.DATA.ACTION eq 'editreport'}
        {include file=$CURRENT.OBJECT->objectTemplatePath_control_mpwsRTEWH
            _type=$DTV_CFG.editor.type
            _name=$DTV_CFG.editor.name
            _value=$CURRENT.SOURCE.DATA.SCRIPT
            _useDivWrapper=$DTV_CFG.editor.divmode
            _jslib=$DTV_CFG.editor.jslib}
        {/if}
    </div>
    
</div>